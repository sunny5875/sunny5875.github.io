---
layout: post
title: LLDB ì™„ì „ ì •ë³µ
date: '2024-02-29 19:20:23 +0900'
category: Swift
---
# LLDB ì •ë³µ

ì¢…ë¥˜: Swift

[LLDB ì •ë³µ - ì•¼ê³°ë‹·ë„·](https://yagom.net/courses/start-lldb/)

### LLDB(Low level Debugger)

- Appleì—ì„œì˜ ì»´íŒŒì¼ëŸ¬ì— í•„ìš”í•œ toolchain ê°œë°œ í”„ë¡œì íŠ¸
- LLVMì˜ debugger componentë¥¼ ê°œë°œí•˜ëŠ” ì„œë¸Œ í”„ë¡œì íŠ¸ë¥¼ ì˜ë¯¸
- Low levelê¹Œì§€ ë””ë²„ê¹… ê°€ëŠ¥
- c, c++, objective c, swiftë¥¼ ì œê³µ

**Note:**ğŸ’¡ ì‹ ê¸°í•˜ê²Œ xcodeì—ì„œ ì‹¤í–‰ëœ í”„ë¡œì„¸ìŠ¤ì—ë§Œ LLDB ì½˜ì†”ì„ ì“¸ ìˆ˜ ìˆëŠ”ê²Œ ì•„ë‹ˆë¼ lldb- n Finderë¥¼ ì…ë ¥í•˜ë©´ ì‹¤í–‰ì¤‘ì¸ ì•±ì˜ í”„ë¡œì„¸ìŠ¤ì—ì„œë„ attachí•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ!(ë‹¨, csrutil statusë¥¼ í†µí•´ system integrity protectionì„ disableì‹œì¼œì•¼ ê°€ëŠ¥!!)


### ê¸°ì´ˆ ë¬¸ë²•

`(lldb) command [subcommand] -option "this is argument"`

- Command, Subcommand, Option, Argumentë“¤ë¡œ ì´ë£¨ì–´ì ¸ ìˆê³ , ë„ì–´ì“°ê¸°ë¡œ êµ¬ë¶„
- **Commandì™€ Subcommand**
    - LLDB ë‚´ Objectì˜ ì´ë¦„ (etc.Â *breakpoint*,Â *watchpoint*,Â *set*,Â *list*Â â€¦ )
    - ì´ë“¤ì€ ëª¨ë‘ ê³„ì¸µí™”ë˜ì–´ìˆì–´, Commandì— ë”°ë¼ ì‚¬ìš©ê°€ëŠ¥í•œ Subcommand ì¢…ë¥˜ê°€ ë‹¤ë¦„
- **Option**
    - Command ë’¤ ì–´ëŠ ê³³ì—ë“  ìœ„ì¹˜ ê°€ëŠ¥í•˜ë©°, `-`ìœ¼ë¡œ ì‹œì‘
- **Argument**ì— ê³µë°±ì´ í¬í•¨ ë˜ëŠ” ê²½ìš°ë„ ìˆê¸° ë•Œë¬¸ì—,Â `""`ë¡œ ë¬¶ì–´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
(lldb) breakpoint set --file test.c --line 12
// test.c íŒŒì¼ ë‚´ì˜ 12ë¼ì¸ì— breakpointë¥¼ setí•´ë¼ëŠ” ëœ»
```

**Note:**ğŸ’¡ ëŒ€ë¶€ë¶„ì˜ ëª…ë ¹ì–´ë“¤ê³¼ ì˜µì…˜ì€ command ë§¨ ì• 1~2ê°œì˜ ì•ŒíŒŒë²³ìœ¼ë¡œ ì¤„ì—¬ì„œ ì‚¬ìš© ê°€ëŠ¥

(lldb) breakpoint set [option] "arguments"
==
(lldb) br s [option] "arguments"


### Help & Apropos

- LLDBì—ëŠ” ìˆ˜ë§ì€ subcommandì™€ optionì´ ì¡´ì¬í•˜ë¯€ë¡œ helpì™€ aproposë¥¼ í†µí•´ íŒíŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤!!
- Help
    
    í•´ë‹¹ ë¬¸ë²•ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥í•œ Subcommand, Option ë¦¬ìŠ¤íŠ¸ë‚˜ ì‚¬ìš©ë²•ì„ ë³´ì—¬ì£¼ëŠ” ìœ ìš©í•œ ëª…ë ¹ì–´
    
    ```bash
    # LLDBì—ì„œ ì œê³µí•˜ëŠ” Commandê°€ ê¶ê¸ˆí•˜ë‹¤ë©´,
    (lldb) help
    
    # íŠ¹ì • Commandì˜ Subcommandë‚˜, Optionì´ ê¶ê¸ˆí•˜ë‹¤ë©´,
    (lldb) help breakpoint
    (lldb) help breakpoint set
    
    ```
    
- Apropos
    
    ì›í•˜ëŠ” ê¸°ëŠ¥ì˜ ëª…ë ¹ì–´ê°€ ìˆëŠ”ì§€ ê´€ë ¨ í‚¤ì›Œë“œë¥¼ í†µí•´ ì•Œì•„ë³¼ ìˆ˜ìˆëŠ” ëª…ë ¹ì–´
    
    ```bash
    # reference countë¥¼ ì²´í¬í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ê°€ ìˆì„ê¹Œ? ê¶ê¸ˆí•˜ë‹¤ë©´,
    (lldb) apropos "reference count"
    # ê²°ê³¼
    # The following commands may relate to 'reference count':
    #    refcount -- Inspect the reference count data for a Swift object
    ```
    

---

# BreakPoint

### Breakpoint ê´€ë ¨ ëª…ë ¹ì–´ë“¤

**function**

- íŠ¹ì • ì´ë¦„ì„ ê°€ì§„ ëª¨ë“  í•¨ìˆ˜ì— â€”name optionìœ¼ë¡œ break ê±¸ ìˆ˜ ìˆìŒ
    - ì•„ë‹ˆë©´ ì •ê·œí‘œí˜„ì‹ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŒ

```swift
breakpoint set --name viewDidLoad
== b -n viewDidLoad

breakpoint set  --func-regex '^hello'
== rb '^hello'
```

**file**

- íŒŒì¼ì˜ ì´ë¦„ê³¼ line ë²ˆí˜¸ë¥¼ ì´ìš©í•´ì„œ breakë¥¼ ê±¸ ìˆ˜ ìˆìŒ

```swift
# íŠ¹ì • íŒŒì¼ì˜ 20ë²ˆì§¸ lineì—ì„œ break 
  (lldb) br s --file ViewController.swift --line 20
  (lldb) br s -f ViewController.swift -l 20
```

**Note:**ğŸ’¡breakpointê°€ ê±¸ë ¤ ìˆì„ ë•Œ ë…¹ìƒ‰ í–„ë²„ê±° ë²„íŠ¼ì„ ê·¸ë˜ê·¸í•˜ë©´ ë‹¤ìŒ ì‹¤í–‰ ì§€ì ì„ ë³€ê²½í•  ìˆ˜ ìˆìŒ!!

**condition**

- break ê±¸ ë•Œ ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆìŒ

```swift
# viewWillAppear í˜¸ì¶œì‹œ, animatedê°€ trueì¸ ê²½ìš°ì—ë§Œ break
  (lldb) breakpoint set --name "viewWillAppear" --condition animated
  (lldb) br s -n "viewWillAppear" -c animated
```

**command ì‹¤í–‰**

- -command optionìœ¼ë¡œ break ì‹œ ì›í•˜ëŠ” LLDB commandë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŒ

```swift
(lldb) breakpoint set -n "viewDidLoad" --command "po $arg1" -G1
(lldb) br s -n "viewDidLoad" -C "po $arg1" -G1
```

**auto continue option(-G)**

- command ì‹¤í–‰ í›„ì— ìë™ìœ¼ë¡œ breakë¥¼ í’€ì–´ì£¼ëŠ” ì˜µì…˜!

**Note:**ğŸ’¡ ìœ„ì˜ êº¼ë¥¼ í™•ì‹¤íˆ ë” ì¤„ì—¬ì„œ breakpointë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” shorthand command!!

**íŠ¹ì • ì´ë¦„ì„ ê°€ì§„ functionì—ì„œ break**

(lldb) b viewDidLoad

**í˜„ì¬ íŒŒì¼ 20ë²ˆì§¸ lineì—ì„œ break**

(lldb) b 20

**íŠ¹ì • íŒŒì¼ 20ë²ˆì§¸ lineì—ì„œ break**

(lldb) b ViewController.swift:20

**í˜„ì¬ íŒŒì¼ ë‚´ íŠ¹ì • textë¥¼ í¬í•¨í•œ lineì—ì„œ break**

(lldb) b /stop here/

**íŠ¹ì • ì£¼ì†Œê°’ì—ì„œ break**

(lldb) b 0x1234000

</aside>

### Break Point ë¦¬ìŠ¤íŠ¸ í™•ì¸í•˜ê¸°

```swift
  # breakpoint ëª©ë¡ ì „ì²´ ì¶œë ¥
  (lldb) breakpoint list
  (lldb) br list
  # breakpoint ëª©ë¡ ê°„ë‹¨í•˜ê²Œ ì¶œë ¥
  (lldb) br list -b
  # íŠ¹ì • idë¥¼ ê°€ì§„ breakpointì˜ ì •ë³´ë§Œ ì¶œë ¥
  (lldb) br list 1
```

### BreakPoint ì‚­ì œ or ë¹„í™œì„±í™”

```swift
 # breakpoint ì „ì²´ ì‚­ì œ
  (lldb) breakpoint delete
  (lldb) br de
  # íŠ¹ì • breakpoint ì‚­ì œ
  (lldb) br de 1
  # breakpoint ì „ì²´ ë¹„í• ì„±í™”
  (lldb) breakpoint disable
  (lldb) br di
  # íŠ¹ì • breakpoint ë¹„í™œì„±í™”
  (lldb) br di 1.1
```

---

# Stepping

- step over
    - `next` í˜¹ì€ ì¤„ì—¬ì„œ `n`ì„ ì¹˜ë©´ ë‹¤ìŒìœ¼ë¡œ ë„˜ê¸¸ ìˆ˜ ìˆìŒ!!
- step in
    - í•¨ìˆ˜ ì•ˆìœ¼ë¡œ ê°€ê³  ì‹¶ë‹¤ë©´?? `step` í˜¹ì€ `s`ë¡œ í•¨ìˆ˜ ë‚´ë¶€ ì‹œì‘ì§€ì ìœ¼ë¡œ ì´ë™í•´ì¤Œ
- step out
    - í•¨ìˆ˜ê°€ ë¦¬í„´ë  ë•Œê¹Œì§€ ì§„í–‰í•œ í›„ breakë¥¼ ê±¸ì–´ì£¼ê³  ì‹œë‹¤ë©´ `finish`ë¥¼ ì“°ë©´ ë¨!

**Note:**ğŸ’¡breakpointì—ì„œ ë‚˜ê°€ê³  ì‹¶ìœ¼ë©´ `continue`ë¥¼ ì“°ë©´ ë¨

---

# Expression

### **po**

- ìš°ë¦¬ê°€ ì•„ëŠ” poëŠ” ë°”ë¡œ `expression -O â€”`ì˜ ì¤„ì„ë§ì„!!
- `po self` ë¥¼ í•˜ë©´ NSObjectì˜ debugDescriptionì´ ì¶œë ¥ë¨
    - overrideë¥¼ í•´ë†“ìœ¼ë©´ ë§ˆìŒëŒ€ë¡œ ì»¤ìŠ¤í…€ë„ ê°€ëŠ¥!

```swift
override var debugDescription: String {
    return "ì´ ê°ì²´ì˜ debugDescriptionì€ \(super.debugDescription) ì…ë‹ˆë‹¤."
  }

po self // ì´ ê°ì²´ì˜ ì–´ì©Œêµ¬ ì €ì©Œêµ¬
```

### variable ì‚¬ìš©í•˜ê¸°

- expression commandë¡œ ê°’ì„ ë³€ê²½í•´ì¤„ ìˆ˜ë„ ìˆìŒ!!!
- LLDBëŠ” ë‚´ë¶€ì ìœ¼ë¡œ local varaibleì„ $R~í˜•íƒœë¡œ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ê·¸ê±¸ ë³´ê³  ê°’ì„ ë°”ê¾¸ë©´ ë˜ëŠ” ê±°ì§€!!

```swift
expression self.view // ì´ê±¸ ì¶œë ¥í•˜ë©´ í•´ë‹¹ $R~ì–´ì©Œêµ¬ê°€ ë­ê°€ ìˆëŠ”ì§€ ë‹¤ ì¶œë ¥ë¨
expression $R0.backgroundColor = .blue // ì´ë ‡ê²Œí•˜ë©´ $R0ì¸ ì¹œêµ¬ì˜ ë°±ê·¸ë¼ìš´ë“œê°€ blueë¡œ ë³€ê²½ë¨!
continue
```

### variable ì„ ì–¸í•˜ê¸°

- expression commandë¡œ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•  ìˆ˜ë„ ìˆìŒ!!
- ë‹¨, ë³€ìˆ˜ëª…ì— $ë¥¼ ë¶™ì—¬ì¤˜ì•¼í•¨!

```swift
(lldb) expr let $someNumber = 10 // í•˜ì§€ë§Œ po selfí•˜ë©´ ë³´ì´ì§€ëŠ” ì•Šì§€ë§Œ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ì´ ë¨!
```

### **`-ignore-breakpoints`Â option í™œìš©í•˜ê¸°**

`--ignore-breakpoints`ëŠ” ìœ ìš©í•œ optionì¤‘ í•˜ë‚˜ë¡œ, expression ì‹¤í–‰ ì¤‘ ë§Œë‚˜ëŠ” breakpointë¥¼ ignoreí• ì§€ ì—¬ë¶€ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (*default ê°’ì€ â€“ignore-breakpoint true ì…ë‹ˆë‹¤.*)

```
#  ì‹¤í–‰ ë„ì¤‘ breakpointë¥¼ ë§Œë‚˜ë„ ê·¸ëƒ¥ ì§„í–‰
(lldb) expression --ignore-breakpoints true --
(lldb) ex -i 1 --
#  ì‹¤í–‰ ë„ì¤‘ breakpointë¥¼ ë§Œë‚˜ë©´ ë©ˆì¶¤
(lldb) expression --ignore-breakpoints false --
(lldb) ex -i 0 --
```

### **ì£¼ì†Œê°’ ì´ìš©í•´ì„œ ë³€ìˆ˜ ì‚¬ìš©í•´ë³´ê¸°**

ê°ì²´ì˜ ì£¼ì†Œê°’ê³¼ Typeë§Œì„ ì•Œê³ ìˆëŠ” ê²½ìš°, í•´ë‹¹ ë³€ìˆ˜ì˜ ì •ë³´ë¥¼ ì•Œì•„ë³¼ ìˆ˜ ìˆì„ê¹Œìš”? ë„¤! Swiftì˜Â `unsafeBitCast(to:)`í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ê°€ëŠ¥í•©ë‹ˆë‹¤

```swift
expr -l swift -- import UIKit // uikit importë„ ê°€ëŠ¥!
```

---

# Image List

- `image list`
    - í˜„ì¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë¡œë“œë˜ì–´ ìˆëŠ” ëª¨ë“  ëª¨ë“ˆë“¤ì˜ ì •ë³´ë¥¼ ì¶œë ¥
- `image dump`
    - ëª¨ë“  ëª¨ë“ˆì˜ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ë½‘ì„ ìˆ˜ ìˆìŒ
- `image lookup`
    - íŠ¹ì • í•„í„°ë§í•´ì„œ ëª¨ë“ˆì˜ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŒ

```swift
# í•¨ìˆ˜ ì´ë¦„ (--function)
  (lldb) image lookup -F "functionName"
  # ì£¼ì†Œê°’ (--address)
  (lldb) image lookup -a "0x00address"
  # íŒŒì¼ ì´ë¦„ (--filename)
  (lldb) image lookup -f "FileName.swift"
  # ë¼ì¸ ë²ˆí˜¸ (--line)
  (lldb) image lookup -f "FileName.swift" -l 15
  # ì •ê·œì‹ ì´ìš© (--regex)
  (lldb) image lookup -rn "regexExpression"

```

### í¬ë˜ì‹œë‚œ ê³³ í•œë²ˆì— ì°¾ì•„ë³´ê¸°

í¬ë˜ì‹œ ë‚¬ì„ ë•Œì˜ ë¡œê·¸ í˜•íƒœ í¬ê²Œ 3ê°€ì§€!

ì•ˆì´ìœ, ì¡°ê¸ˆ ì´ìœ, ì´ìœ í˜•íƒœâ€¦ ì´ë ‡ê²Œ êµ¬ì„±ë˜ì–´ ìˆìŒ

![Untitled](/assets/2024-02-29-LLDB-á„‹á…ªá†«á„Œá…¥á†«-á„Œá…¥á†¼á„‡á…©á†¨/Untitled.png)

Q. ìœ„ì—ì²˜ëŸ¼ ì—ëŸ¬ê°€ ë‚˜ë©´ ì–´ë””ì„œ ë¬¸ì œê°€ ì¼ì–´ë‚¬ëŠ”ì§€ íŒŒì•…í•˜ê¸° ì•„ì£¼ ì–´ë ¤ìš´ë° ì–´ë–»ê²Œ ë³¼ ìˆ˜ ìˆì„ê¹Œ?

A. ê°€ì¥ ìƒë‹¨ì˜ Unsymbolicated Crash Logì˜ Backtraceë¥¼ ë³´ë©´

```
    0  The Elements  0x000000010003fc20 0x100034000 + 48160 // stack address load address offset
    1  UIKit                    0x0000000187480070 0x187438000 + 295024
    2  UIKit                    0x000000018747feb0 0x187438000 + 294576
    ...
```

â€“Â **Binary Image Name**Â :Â *The Elements*Â ëŠ” Crashê°€ ë°œìƒí•œ Main Application ì‹¤í–‰ íŒŒì¼ì…ë‹ˆë‹¤.

â€“Â **Stack Address**Â : í•´ë‹¹ Symbolì˜ Stack ë©”ëª¨ë¦¬ ë‚´ ì£¼ì†Œê°’ì„ ì˜ë¯¸í•˜ë©°, ìœ„ traceì—ì„œëŠ”Â *0x000000010003fc20*ì— í•´ë‹¹í•©ë‹ˆë‹¤.

â€“Â **Load Address**Â : Applicationì´ Loadë˜ì–´ìˆëŠ” ì£¼ì†Œê°’ì„ ì˜ë¯¸í•˜ë©°, ìœ„ traceì—ì„œëŠ”Â *0x100034000*Â ì— í•´ë‹¹í•©ë‹ˆë‹¤.

â€“Â **Offset**:Â *48160*ëŠ” StackAddressì™€ LoadAddress ì‚¬ì´ì˜ Offsetì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

( ==Â *StackAddress*Â â€“Â *LoadAddress*Â )

```
symbol address = slide + stack address - load address
               = slide + offset
# slide valueëŠ” 32bit architectureì˜ ê²½ìš°  0x4000, 64bit architectureì˜ ê²½ìš°  0x100000000ë¥¼ ê°€ì§‘ë‹ˆë‹¤.

=> symbol address = 0x100000000 + BC20 = 0x10000BC20 # ì°¸ê³ : 48160 (10ì§„ìˆ˜) == BC20 (16ì§„ìˆ˜)
```

- *0x10000BC20*Â ì´ ë¬¸ì œì˜ ì§€ì !!!! ğŸ¤¬
- Terminalì„ ì—´ê³ Â `$ lldb`ë¥¼ í†µí•´ LLDB Consoleì„ ì—¶
- `(lldb) target create "dSYM ê²½ë¡œâ€` ìœ¼ë¡œ dSYM fileì— attach
- `(lldb) image lookup --address 0x10000bc20` symbol ìœ„ì¹˜ ê²€ìƒ‰í•´ì£¼ë©´ ì–´ë””ì„œ ì¼ì–´ë‚¬ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŒ!!

cf. ìì£¼ì“°ëŠ” ëª…ë ¹ì–´ê°€ ìˆë‹¤ë©´ ~/.lldbinit íŒŒì¼ì— ì›í•˜ëŠ” `command alias ë³„ëª… "ì¤„ì´ê³  ì‹¶ì€ Commandâ€` ì„ ë„£ì–´ì„œ ì“°ë©´ ë¨!

cf. ì¢€ ë” LLDBë¥¼ ì˜ì“°ê²Œ í•´ì£¼ëŠ” íˆ´: **[Derek Selander](https://github.com/DerekSelander/LLDB), [Chisel](https://github.com/facebook/chisel)**

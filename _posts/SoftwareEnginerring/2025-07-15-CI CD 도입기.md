---
layout: post
title: CI/CD ë„ì…ê¸°
date: 2025-07-15 21:16:50 +0900
category: SoftwareEnginerring
---

# CI/CD ë„ì…ê¸°

### ë„ì… ì´ìœ 

- ê¸°ì¡´ì—ëŠ” ì‚¬ìš©í•˜ê³  ìˆëŠ” í”„ë ˆì„ì›Œí¬ ì¤‘ í•˜ë‚˜ê°€ ì‹œë®¬ë ˆì´í„°ìš© ë²„ì „ì´ ì—†ì–´ì„œ CI/CDê°€ ë¶ˆê°€ëŠ¥í–ˆëŠ”ë° ì‹œë®¬ë ˆì´í„°ìš© ë²„ì „ì„ ìƒì„±í•¨ìœ¼ë¡œì¨ ë„ì…ì´ ê°€ëŠ¥í•˜ê²Œ ë¨!
- devì— ë¨¸ì§€í•  ë•Œë§ˆë‹¤ ê°€ë” ë¨¸ì§€ë¥¼ ì˜ëª»í•´ì„œ ë¹Œë“œê°€ ì•ˆë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆê³  ì´ë¡œ ì¸í•´ ë„ì…ì„ ì¶”ì§„í•˜ê²Œ ë¨ ğŸ™‚

### ê¸°ë³¸ ì›ë¦¬

- Match
    - ì¸ì¦ì„œ ìë™ ê´€ë¦¬
        - ê°œë°œìê°€ ëˆ„êµ¬ì¸ì§€ ì¦ëª…í•˜ëŠ” ì„œëª… ë„êµ¬
    - í”„ë¡œë¹„ì €ë‹ í”„ë¡œíŒŒì¼ ê´€ë¦¬
        - ì´ ì•±ì´ ì–´ë””ì„œ ì‹¤í–‰ê°€ëŠ¥í•œì§€ ì •í•˜ëŠ” í—ˆê°€ì¦
- FastLane
    - ìë™ìœ¼ë¡œ ì¶œì‹œ í˜¹ì€ Testflightì— ë°°í¬í•˜ëŠ” ì—­í• 
    - matchëŠ” fastlaneì˜ subcommand

### ë„ì… ê³¼ì •

- Bitbucketì˜ self cost serverë¥¼ ì¶”ê°€í•˜ì—¬ ë‚´ pcë¡œ ì§€ì •
    - bitbucket cloudëŠ” ì¼ì • ë¹„ìš©ì´ ë“¤ì–´ì„œ í˜„ì¬ëŠ” ë‚˜ì˜ pcë¥¼ ì‚¬ìš©í•˜ëŠ” ê±¸ë¡œ ì„¸íŒ…
- **match private repo**ë¥¼ ìƒì„±
- í”„ë¡œì íŠ¸ repoì—ì„œ **matchFile** ì‘ì„±
    
    ```swift
    git_url("ë§¤ì¹˜íŒŒì¼ url")
    
    storage_mode("git")
    
    type("development") 
    app_identifier(["bundle identier"])
    username("ê³„ì •ëª…") 
    force_for_new_devices(true)
    
    ```
    
- í”„ë¡œì íŠ¸ repoì—ì„œ `fastlane match development`ëª…ë ¹ì–´ ì‹¤í–‰í•˜ì—¬ ì¸ì¦ì„œ, í”„ë¡œë¹„ì €ë‹ íŒŒì¼ ìƒì„±
    - ìë™ìœ¼ë¡œ match repoì— ì¸ì¦ì„œ ë° í”„ë¡œë¹„ì €ë‹ íŒŒì¼ì´ ìƒì„±ë¨
- í”„ë¡œì íŠ¸ repoì—ì„œ `Fastlane init`
    - AppFile: ì•± ê¸°ë³¸ ì •ë³´ ì„¤ì •
        
        ```swift
        app_identifier("bundle identier")
        apple_id("ê³„ì •ID") 
        itc_team_id("App Store Connect Team ID") 
        team_id("Developer Portal Team ID")
        ```
        
    - FastFile: ìë™í™” ë™ì‘ ì •ì˜
        
        ```swift
        lane :beta do
          version = get_version_number(
            xcodeproj: "í”„ë¡œì íŠ¸ëª….xcodeproj",     
            target:    "í”„ë¡œì íŠ¸ëª…"                
          )
        
          new_build = latest_testflight_build_number + 1
          increment_build_number(build_number: new_build)
          
          build_app(
            scheme: "í”„ë¡œì íŠ¸ëª…",
            export_method: "app-store",
            export_options: {
              provisioningProfiles: { 
                "com.ltcware-inc.uniwaffle" => "match AppStore com.ltcware-inc.uniwaffle"
              }
            }
          )
          upload_to_testflight
          
          tag_name = "v#{version}_build#{new_build}"       
          add_git_tag(tag: tag_name)                   
          push_git_tags 
          
           slack(
              message: "iOS Testflight ë°°í¬ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤! #{tag_name}",
              slack_url: "ìŠ¬ë™ ìˆ˜ì‹ ì›¹í›„í¬ url"
           )
        end
        ```
        
- **pipeLine** ì½”ë“œ ì‘ì„±
    
    ```swift
    pipelines:
      branches:
        develop:       # develop ë¸Œëœì¹˜ì— push â†’ CI ì‹¤í–‰
          - step:
              runs-on:
                - self.hosted
                - macos
              script:
                - xcodebuild -project í”„ë¡œì íŠ¸ëª….xcodeproj -scheme í”„ë¡œì íŠ¸ëª… -destination 'platform=iOS Simulator,name=iPhone 16,OS=18.0' clean build
    
        main:          # main ë¸Œëœì¹˜ì— push â†’ testflight CD ì‹¤í–‰
          - step:
              runs-on:
                - self.hosted
                - macos
              script:
                - fastlane beta
    ```
    

<aside>
âš ï¸

í˜„ì¬ëŠ” ê°€ìƒ pcê°€ ì•„ë‹Œ ì‹¤ì œ ë‚˜ì˜ pcë¡œ ëŒë¦¬ëŠ” ê±°ê¸° ë•Œë¬¸ì— í•­ìƒ ë‚´ pcê°€ ì¼œì ¸ ìˆì–´ì•¼í•œë‹¤! ê°€ìƒ pcë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì¼ì • ë¹„ìš© ì²­êµ¬ ë  ìˆ˜ ìˆë‹¤.

</aside>

---

### Test ì½”ë“œ ì¶”ê°€

- ê¸°ì¡´ì— ìˆë˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ìµœê·¼ì— ê´€ë¦¬í•˜ê³  ìˆì§€ ì•Šì•˜ëŠ”ë° ì´ë²ˆ ê¸°íšŒì— ë§¤ì£¼ ë¦´ë¦¬ì¦ˆë¥¼ í•˜ê¸°ë¡œ í–ˆê¸°ì— ì´ë²ˆì— ê°™ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë„£ì–´ë³´ë ¤ê³  í•œë‹¤
- ì¼ë‹¨ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” XCTestë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³  CICDì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ëŒë¦¬ëŠ” ê²ƒë§Œ ì§„í–‰í•˜ë ¤ê³  í•¨!

â‡’ Test Planì„ ì¶”ê°€í•´ì„œ ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ëª¨ë“ˆì„ ê´€ë¦¬í•˜ê³  ê·¸ í›„ì— í•´ë‹¹ TestPlanì„ ì‹¤í–‰

```swift
pipelines:
  branches:
    develop:       # develop ë¸Œëœì¹˜ì— push â†’ CI ì‹¤í–‰
      - step:
          runs-on:
            - self.hosted
            - macos
          script:
           - xcodebuild -project Uniwaffle_iOS.xcodeproj \
           -scheme Uniwaffle_iOS \
           -testPlan Uniwaffle_iOS_Test \
           -destination 'platform=iOS Simulator,name=iPhone 16,OS=18.3.1' \
           -derivedDataPath ./build \
           clean test | xcpretty --test --color

    main:          # main ë¸Œëœì¹˜ì— push â†’ testflight CD ì‹¤í–‰
      - step:
          runs-on:
            - self.hosted
            - macos
          script:
            - fastlane beta
```

<aside>
âš ï¸

xcodeì—ì„œëŠ” ì˜ë˜ì—ˆëŠ”ë° í„°ë¯¸ë„ì—ì„œëŠ” ìê¾¸ ì•ˆë˜ì–´ì„œ ì°¾ì•„ë³´ë‹ˆê¹Œ DYSM Run Scriptì—ì„œ ì‹¤íŒ¨í•´ì„œ ì•ˆë˜ëŠ” ê±°ì˜€ë‹¤!! í•´ë‹¹ Run Script ì—ëŸ¬ ì²˜ë¦¬ë„ í•´ì¤˜ì•¼ í•¨
ê·¸ë¦¬ê³  í…ŒìŠ¤íŠ¸ ëª¨ë“ˆì— Test ì½”ë“œê°€  í•˜ë‚˜ë„ ì—†ì–´ë„ failì²˜ë¦¬ ë˜ë¯€ë¡œ ì´ê²ƒë„ ì²˜ë¦¬í•´ì¤„ ê²ƒ!!

</aside>
